<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.thumbtack.hospital.mapper.DoctorMapper">
    <select id="getAllDoctors" resultType="net.thumbtack.hospital.model.Doctor">
        SELECT user.id    AS doctorId,
               login,
               password,
               firstName,
               lastName,
               patronymic,
               ds.name    AS specialty,
               c.name     AS cabinet,
               sc.id      AS scheduleCellId,
               date,
               time,
               ticket,
               duration,
               firstName  AS patientFirstName,
               lastName   AS patientLastName,
               patronymic AS patientPatronymic,
               email      AS patientEmail,
               address    AS patientAddress,
               phone      AS patientPhone
        FROM user
                 JOIN doctor d ON user.id = d.userId
                 JOIN doctor_specialty ds ON d.specialtyId = ds.id
                 LEFT JOIN cabinet c ON d.cabinetId = c.id
                 LEFT JOIN schedule_cell sc ON d.userId = sc.doctorId
                 JOIN time_cell tc ON sc.id = tc.scheduleCellId
                 LEFT JOIN patient p ON tc.patientId = p.userId;
    </select>

    <select id="getDoctorById" parameterType="int" resultType="net.thumbtack.hospital.model.Doctor">
        SELECT user.id    AS doctorId,
               login,
               password,
               firstName,
               lastName,
               patronymic,
               ds.name    AS specialty,
               c.name     AS cabinet,
               sc.id      AS scheduleCellId,
               date,
               time,
               ticket,
               duration,
               firstName  AS patientFirstName,
               lastName   AS patientLastName,
               patronymic AS patientPatronymic,
               email      AS patientEmail,
               address    AS patientAddress,
               phone      AS patientPhone
        FROM user
                 JOIN doctor d ON user.id = d.userId
                 JOIN doctor_specialty ds ON d.specialtyId = ds.id
                 LEFT JOIN cabinet c ON d.cabinetId = c.id
                 LEFT JOIN schedule_cell sc ON d.userId = sc.doctorId
                 JOIN time_cell tc ON sc.id = tc.scheduleCellId
                 LEFT JOIN patient p ON tc.patientId = p.userId
        WHERE doctorId = #{id};
    </select>
</mapper>